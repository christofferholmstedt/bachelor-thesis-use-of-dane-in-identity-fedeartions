\section{How to improve security for Identity federations}
\section{How to combine Identity federations and DANE}
As stated earlier it's possible to divide federations into two categories, those with a federation provider and those without.
In the analysis that has been done the solution with a federation provider is the most probable and viable setup in the long run, it's basiclly much easier to scale, both technically and non-technically.
It's with this configuration in mind the following evaluation has been made.

%TODO: (1) Kontrollera att det finns information om båda kategorierna av federationer.
%TODO: (2) Kontrollera att analys är gjord och att det verkligen är varianten med en FO som är mest trolig.

With a federation provider publishing all the metadata about all service providers, identity providers and other entities how do the trusting entites rely on the federation provider?
Is it the correct federation provider the trusting entities connect to or is it someone trying to "impersonate" the role of the federation provider as a man-in-the-middle attack.

As of now the trust must be made in some out-of-band way e.g. a simple download of the federation provider's certificate and then confirm it's the correct one via telephone or email communcation between administrators.
This is not very practical when the federation grows bigger with tenths or hundreds of service and identity providers.

\subsection{SAML2 certificate as a CERT RR resource record}
\label{subsec:saml2-certificate-as-tlsa}
% TODO: SAML2 certificate might be put in a CERT RR not a TLSA RR
The first solution that comes into mind is that it might be possible to publish the federation provider's certificate in the DNS system and more specifically as a CERT RR\cite{rfc:4398}.
This would mean that when a requesting entity (service provider, identity provider or any other entity) needs to update the metadata about all other entities it connects to the federation provider and downloads the metadata.
At the same time the requesting entity sends out a DNS lookup (with DNSSEC active) for a corresponding CERT RR.
When both the metadata and the CERT RR is retrieved, a comparison can be made and confirm or dismiss the validity of the metadata.

A problem that still exists with this approach is how will the metadata about each entity be transmitted to the federation provider and validated by the federation provider.
To keep building on the same solution each entity would have to publish respective certificate as a CERT RR themselves in their own domain zone.
Now the initial upload of metadata from an entity to the federation provider could be intitated, perhaps through a web interface, with or without some "Pretty Good Privacy" (PGP) solution e.g. OpenPGP\cite{rfc:5011}.
% TODO: Add use cases from registry->registrar in DNS and how it is used their.
The federation provider than fetches the metadata aswell as the corresponding CERT RR from the entity and if it's the correct signature on it the federation provider can publish it with the metadata from all other entities.
Within one cache interval all entities will now fetch a complete updated metadata file/list from the federation provider.

% TODO: What is a cache interval?
% TODO: What is a domain zone?

New questions arises here, is it practical to store SAML2 certificates in the DNS system as a CERT RR?
The second question that comes to mind is more related to DANE.
If CERT RRs is used as stated above it would require DNSSEC otherwise its value would be of no use.
Is it not possible to just use the TLSA RR with TLS certificates as it is and not introduce another layer that CERT RRs would become within the same system (DNS and DNSSEC)?

\subsection{Only use TLS with TLSA RR}
\label{subsec:only-tlsa-rr-with-tls}
Let's start with the second question and get back to the first one later on.
The solution is already at the point where all entities within a federation needs to sign their own zone with DNSSEC as an underlying infrastructure.
Instead of publishing SAML2 certificates in the DNS system it might be possible to just use the TLSA RRs with TLS and deem that all the information communicated between any two entities is valid as long as it's over TLS that has been established with TLSA RRs procedures.

This would mean that when a new entity, let's say a service provider, joins a federation the service provider must send its metadata to the federation provider.
As an example the administrator for the service provider might visit a webpage over https(with validity check for TLSA RR) to initiate the transfer of metadata.
The federation provider than sends a request over https(with validity check for TLSA RR) for the metadata from the service provider.
When the metadata is recieved the federation provider can publish it with the metadata for all other entities.

% TODO: What is metadata?
% TODO: What is an entity?

\subsection{Publishing SAML2 certificate as a CERT RR}
Earlier in subsection \ref{subsec:saml2-certificate-as-tlsa} the question arose if it is practical to store SAML2 certificates in the DNS system.

\subsection{Publishing SAML2 certificate as CERT RRs and TLS certificate as TLSA RR}
% Nah, not needed as we say in Sweden "kaka på kaka" no extra security added.
% TODO: More research into this? Perhaps we will give an answer to this that is enough.

% \cite[p.~256]{pdf:SOU}

%\section{Temporary section}
%EVALUATION This is where you put the spotlight on your solution's strengths and
%weaknesses. An evaluation must be made of the methods/theory applied and the validity
%and reliability of the data. You should describe the most interesting results of your work in a
%results section. Remember that less important but complementary results can to advantage
%be placed in appendices. A rule of thumb is that all results that you use in your analysis and
%in your conclusions should be reported in the Evaluation chapter and the rest reported in
%appendices.


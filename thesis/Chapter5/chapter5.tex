\section{Our conclussions}
\subsection{Identity federations with SAML2 and DANE}
We started out with the task to identify where we could improve security within idenitity federations.
We were tasked specifically to look at the data integrity part of SAML2, how X.509 certificates are used and how it would be possible to improve security with the help of DNS-Based Authentication of Named Entities.

Our conclussion is that as soon as the initial configuration for each entity in an identity federation is done and all 
entities are up and running, data integrity is as secure as the public/private key cryptography scheme.
However, the difficulty is still in the initial setup, how to decide who to trust when you don't trust anyone online. 
As well as emergency key rollower, when the key one day becomes invalid. 
Procedures for this is as of today not specified in any detail, it's up to each federation to decide on their own.
Common practice is as said in earlier chapters to share key or certificate information in some out-of-band way e.g. meeting in person or call each other.
We belive that it is this initial sharing of information that would benefit the most if it could be done solely over the internet and it's possible if we put trust in the DNSSEC infrastructure.

DANE is one way to go and is a valid solution for identity federations.
However, exactly how to store SAML2 certificates and how to retrieve the correct certificate for each validation of metadata is still an open question we haven't been able to reach that far.
We have listed some solutions such as using CERT resource records and perhaps locating the correct certificate with "Dynamic Delegation Discovery System (DDDS)" procedures.

Furthermore, our belief is that within future SAML specifications and/or when establishing new federations, more strict rules concerning metadata must be agreed upon to secure the data integrity of the metadata.
Future agreements should include requirements that TLS with TLSA validation is used when sharing metadata.
Another requirement should be to publish the certificates within the DNS/DNSSEC infrastructure.
This is to make sure that both the channel that the communication is taking part over is secure aswell as the data stored on the webserver accessed is the proper one e.g. if downloading a certificate over a HTTPS connection.
DANE may be used, instead of, or as an addition to current procedures.


\subsection{Proof of concept}
TODO - Implementation

%DANE
%Säkra både TLS och certifikat eftersom webbserver kan hackas men inte så troligt att även zonen blir hackad eftersom det är vanligt att placera en master server bakom många slav-servrar som är blåttade mot omvärlden.


%Connect back to the topic under "Chapter 1: Purpose". Do we reach our purpose?
% TODO: Make comments about that if we can secure the transmission of Metadata between all entities (FOs, IdPs, AAs, SPs and Discos) we can deem that the data integrity of all messages transmitted between them(the entities) is not lost or tampered with. As long as all entities do a proper check for each SAML2 message.

\section{How to continue with further research}
\subsection{Secure communication with a federation operator}
The communication between the federation operator and the other entities such as identity providers and service providers has no standardized way in how it should work.
How does the federation operator know that it really is the right identity provider it's talking with, without any prior communication?
Should the federation operator be the one that initiate connection to the other entities or vice versa?
Last, but not least, how should this be solved technically to minimize the manual labour and automate as much as possible?

\subsection{SAML2 certificates in CERT resource records}
In section \ref{subsec:saml2-certs-in-cert-rr} it's mentioned that SAML2 certificates could be stored in CERT RRs.
Further research need to be done to establish exactly how this could be accomplished.
With CERT RR it's possible to store the certificate in it's full format, only a hash of it or just a url to the location where it's stored\cite[ch. 2.1]{rfc:4398}.
What would be suitable for SAML2 certificates and is this really a viable solution for the identity federation scheme?

\subsection{How to use NAPTR RRs to find the correct SAML2 certificate}
In section \ref{subsec:matching-dilemma} "Dynamic Delegation Discovery System (DDDS)"\cite{rfc:3401,rfc:3402,rfc:3403,rfc:3404} and the NAPTR resource record\cite{rfc:3403} is mentioned as a possible solution to the "matching problem".
How does an entitiy that has recieved a signed metadata file locate the correct certificate within the Domain Name System?

%\section{Temporary section }
%DISCUSSION Your conclusions, where you link your findings to your theories and purpose,
%will discuss whether you achieved your purpose and what opportunities exist for further
%development. An analysis and interpretation of your results may often correspond to the
%frame of reference and the theoretical models you have used. Using models, checklists etc,
%you broke down your task into manageable questions. Now you reverse your approach and
%use them to build general conclusions and recommendations that correspond to your
%purpose and your client's decision situation.

